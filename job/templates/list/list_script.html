{% load static %}
<script src="{% static 'js/job_list_vue.js' %}"></script>

<script>


    $(document).ready(function() {

        var data = {{data|safe}}
        var user = {{ request.userModel|safe }}

        var jobList = data['jobList']
        var totalPage = data['totalPage']
        listVue.user = user
        listVue.jobList = jobList
        intComma(listVue.jobList)
        listVue.totalPage = totalPage
        listVue.locations = {{ locations|safe }}
        listVue.selectedLocation = {{ selectedLocation|safe }}

        onLoadMoreScroll(listVue)
    })

    function intComma(jobList) {

        for (var i = 0; i < jobList.length; i++) {
<!--            원본데이터 변경을 방지하기 위해 새로운 변수에 담는다.-->
            jobList[i].payWithComma = numberWithCommas(jobList[i].pay)
        }
    }

     // 페이징 스크롤 리스너
    function onLoadMoreScroll(listVue) {

        var windowHeight = $(window).height();
        var scrollYOffset = 200

        $(window).scroll(function () {
            var documentHeight = $(document).height();
            var scrollHeight = documentHeight - windowHeight

            // 스크롤길이가 200 이상일때
            if (scrollHeight >= 200) {

               var scrollY = $(document).scrollTop();
               if (scrollY >= 140) {
                  $("#toolbar").show()
               }
               else {
                  $("#toolbar").hide()
               }

               // 스크롤길이가 200 정도 남았고, 마지막페이지가 아니며, 페이징중이 아니라면 추가로 로드한다.
               if (scrollY > (scrollHeight - 200) && listVue.isLoadMore() && !listVue.isPaging) {

                    listVue.isPaging = true
                    listVue.getJobList()
               }
           }
        });

    }










</script>
